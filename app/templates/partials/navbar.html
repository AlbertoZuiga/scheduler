
<header class="sticky top-0 z-30 w-full bg-light-surface/80 dark:bg-dark-surface/80 shadow-sm backdrop-blur transition-colors duration-300 border-b border-light-border dark:border-dark-border">
  <nav class="max-w-5xl mx-auto flex items-center justify-between px-3 sm:px-4 py-3">
    <a href="{{ url_for('main.index') }}" class="flex items-center gap-2 font-bold text-base sm:text-lg text-primary dark:text-accent hover:opacity-80 transition touch-manipulation" aria-label="Ir a la página de inicio">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-7 sm:w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
      <span class="hidden xs:inline sm:inline">Scheduler</span>
    </a>
    <div class="flex items-center gap-1 sm:gap-2">
      <!-- Mobile menu button -->
      <button id="menu-toggle" class="md:hidden p-2 rounded-lg hover:bg-light-muted/30 dark:hover:bg-dark-muted/30 focus:outline-none focus:ring-2 focus:ring-primary active:scale-95 transition-all touch-manipulation" aria-label="Abrir menú de navegación" aria-expanded="false">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
      </button>
      <!-- Desktop menu -->
      <ul class="hidden md:flex items-center gap-2 font-medium text-sm">
        {% if current_user.is_authenticated %}
          <li>
            <a href="{{ url_for('groups.index') }}" class="px-3 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-accent/10 transition touch-manipulation" aria-label="Ir al panel de control">Mis Grupos</a>
          </li>
          <li class="relative group">
            <button class="flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-accent/10 transition focus:outline-none touch-manipulation" id="user-menu" aria-haspopup="true">
              {% if current_user.picture %}
                <img src="{{ current_user.picture }}" alt="Avatar" class="rounded-full w-7 h-7 sm:w-8 sm:h-8 object-cover">
              {% else %}
                <span class="inline-block w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-primary/20 dark:bg-accent/20 flex items-center justify-center text-primary dark:text-accent font-bold text-sm">{{ current_user.name[0]|default('U') }}</span>
              {% endif %}
              <span class="hidden lg:inline text-sm">{{ current_user.name or current_user.email }}</span>
              <svg class="w-3 h-3 sm:w-4 sm:h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </button>
            <ul class="absolute right-0 mt-2 w-48 bg-light-card dark:bg-dark-card rounded-lg shadow-lg py-2 hidden group-focus-within:block group-hover:block z-20 border border-light-border dark:border-dark-border">
              <li><span class="block px-4 py-2 text-xs text-light-text-secondary dark:text-dark-text-secondary truncate">{{ current_user.email }}</span></li>
              <li><hr class="my-1 border-light-border dark:border-dark-border"></li>
              <li>
                <a href="{{ url_for('auth.logout') }}" class="block px-4 py-2 hover:bg-primary/10 dark:hover:bg-accent/10 rounded transition text-sm touch-manipulation">Cerrar sesión</a>
              </li>
            </ul>
          </li>
        {% else %}
          <li>
            <a href="{{ url_for('auth.login') }}" class="px-3 py-2 rounded-lg hover:bg-primary/10 dark:hover:bg-accent/10 transition text-sm touch-manipulation" aria-label="Iniciar sesión">Iniciar sesión</a>
          </li>
        {% endif %}
        <li>
          <!-- Dark mode toggle -->
          <button id="dark-toggle" class="ml-1 sm:ml-2 p-2 rounded-lg hover:bg-light-muted/30 dark:hover:bg-dark-muted/30 focus:outline-none focus:ring-2 focus:ring-primary active:scale-95 transition-all touch-manipulation" aria-label="Alternar modo oscuro">
            <svg id="icon-sun" class="h-5 w-5 hidden text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-13.66l-.71.71M4.05 19.95l-.71.71M21 12h-1M4 12H3m16.66 6.66l-.71-.71M4.05 4.05l-.71-.71M12 7a5 5 0 100 10 5 5 0 000-10z" /></svg>
            <svg id="icon-moon" class="h-5 w-5 hidden text-light-text-primary dark:text-dark-text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z" /></svg>
          </button>
        </li>
      </ul>
    </div>
  </nav>
  <!-- Mobile menu -->
  <div id="mobile-menu" class="md:hidden hidden px-3 pb-3 border-t border-light-border dark:border-dark-border bg-light-surface dark:bg-dark-surface">
    <ul class="flex flex-col gap-2 font-medium pt-3">
      {% if current_user.is_authenticated %}
        <li>
          <a href="{{ url_for('groups.index') }}" class="flex items-center gap-2 px-3 py-3 rounded-lg hover:bg-primary/10 dark:hover:bg-accent/10 transition touch-manipulation active:scale-98">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
            Mis Grupos
          </a>
        </li>
        <li>
          <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-2 px-3 py-3 rounded-lg hover:bg-primary/10 dark:hover:bg-accent/10 transition touch-manipulation active:scale-98">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
            Cerrar sesión
          </a>
        </li>
      {% else %}
        <li>
          <a href="{{ url_for('auth.login') }}" class="flex items-center gap-2 px-3 py-3 rounded-lg hover:bg-primary/10 dark:hover:bg-accent/10 transition touch-manipulation active:scale-98">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/></svg>
            Iniciar sesión
          </a>
        </li>
      {% endif %}
      <li>
        <button id="dark-toggle-mobile" class="w-full text-left px-3 py-3 rounded-lg hover:bg-light-muted/30 dark:hover:bg-dark-muted/30 focus:outline-none focus:ring-2 focus:ring-primary touch-manipulation active:scale-98" aria-label="Alternar modo oscuro">
          <span class="flex items-center gap-2">
            <svg id="icon-sun-mobile" class="h-5 w-5 hidden text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-13.66l-.71.71M4.05 19.95l-.71.71M21 12h-1M4 12H3m16.66 6.66l-.71-.71M4.05 4.05l-.71-.71M12 7a5 5 0 100 10 5 5 0 000-10z" /></svg>
            <svg id="icon-moon-mobile" class="h-5 w-5 hidden text-light-text-primary dark:text-dark-text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z" /></svg>
            <span id="dark-mode-text">Modo oscuro</span>
          </span>
        </button>
      </li>
    </ul>
  </div>
</header>

<script>
// Mobile menu toggle
document.addEventListener('DOMContentLoaded', function () {
  const menuToggle = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener('click', () => {
      const isExpanded = mobileMenu.classList.toggle('hidden');
      menuToggle.setAttribute('aria-expanded', !isExpanded);
      // Cerrar el menú al hacer clic fuera
      if (!isExpanded) {
        const closeMenu = (e) => {
          if (!mobileMenu.contains(e.target) && !menuToggle.contains(e.target)) {
            mobileMenu.classList.add('hidden');
            menuToggle.setAttribute('aria-expanded', 'false');
            document.removeEventListener('click', closeMenu);
          }
        };
        setTimeout(() => document.addEventListener('click', closeMenu), 0);
      }
    });
  }

  // Dark mode toggle (desktop)
  const darkToggle = document.getElementById('dark-toggle');
  const iconSun = document.getElementById('icon-sun');
  const iconMoon = document.getElementById('icon-moon');
  if (darkToggle && iconSun && iconMoon) {
    function setDarkMode(dark) {
      document.documentElement.classList.toggle('dark', dark);
      localStorage.setItem('theme', dark ? 'dark' : 'light');
      iconSun.classList.toggle('hidden', !dark);
      iconMoon.classList.toggle('hidden', dark);
    }
    // Inicialización
    const userPref = localStorage.getItem('theme');
    const systemPref = globalThis.matchMedia('(prefers-color-scheme: dark)').matches;
    setDarkMode(userPref === 'dark' || (!userPref && systemPref));
    darkToggle.addEventListener('click', () => {
      setDarkMode(!document.documentElement.classList.contains('dark'));
    });
  }
  
  // Dark mode toggle (mobile)
  const darkToggleMobile = document.getElementById('dark-toggle-mobile');
  const iconSunMobile = document.getElementById('icon-sun-mobile');
  const iconMoonMobile = document.getElementById('icon-moon-mobile');
  const darkModeText = document.getElementById('dark-mode-text');
  
  if (darkToggleMobile && iconSunMobile && iconMoonMobile && darkModeText) {
    function setDarkModeMobile(dark) {
      document.documentElement.classList.toggle('dark', dark);
      localStorage.setItem('theme', dark ? 'dark' : 'light');
      iconSunMobile.classList.toggle('hidden', !dark);
      iconMoonMobile.classList.toggle('hidden', dark);
      darkModeText.textContent = dark ? 'Modo claro' : 'Modo oscuro';
    }
    
    // Inicialización
    const userPref = localStorage.getItem('theme');
    const systemPref = globalThis.matchMedia('(prefers-color-scheme: dark)').matches;
    setDarkModeMobile(userPref === 'dark' || (!userPref && systemPref));
    
    darkToggleMobile.addEventListener('click', () => {
      setDarkModeMobile(!document.documentElement.classList.contains('dark'));
    });
  }
});
</script>
